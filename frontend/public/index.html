<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"
    />

    <title>ShilpOneer</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- Chatbot widget -->
    <div id="chatbot-container" class="chatbot-container">
      <button id="chatbot-toggle" class="chatbot-toggle">
        üí¨
      </button>
      <div id="chatbot-window" class="chatbot-window d-none">
        <div class="chatbot-header">
          <span>ShilpOneer Chatbot</span>
          <button id="chatbot-close" class="btn-close btn-close-white"></button>
        </div>
        <div id="chatbot-messages" class="chatbot-messages"></div>
        <div class="chatbot-input-container">
          <input
            id="chatbot-input"
            type="text"
            placeholder="Ask me something..."
          />
          <button id="chatbot-send" class="btn btn-primary">Send</button>
        </div>
      </div>
    </div>

    <!-- Chatbot CSS -->
    <style>
      .chatbot-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
      }
      .chatbot-toggle {
        background: #007bff;
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 24px;
        padding: 12px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      .chatbot-window {
        width: 300px;
        height: 400px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .chatbot-header {
        background: #007bff;
        color: white;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .chatbot-messages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        font-size: 14px;
      }
      .chatbot-input-container {
        display: flex;
        border-top: 1px solid #ddd;
      }
      .chatbot-input-container input {
        flex: 1;
        border: none;
        padding: 10px;
        outline: none;
      }
      .chatbot-input-container button {
        border-radius: 0;
      }
    </style>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      defer
    ></script>

    <!-- Chatbot Script -->
    <script>
      const chatbotToggle = document.getElementById("chatbot-toggle");
      const chatbotWindow = document.getElementById("chatbot-window");
      const chatbotClose = document.getElementById("chatbot-close");
      const chatbotMessages = document.getElementById("chatbot-messages");
      const chatbotInput = document.getElementById("chatbot-input");
      const chatbotSend = document.getElementById("chatbot-send");

      // ‚úÖ Detect backend URL automatically
      const API_BASE =
        window.location.hostname === "localhost"
          ? "http://localhost:2000"
          : "https://your-backend-domain.com"; // change when backend is deployed

      function appendMessage(text, sender = "bot") {
        const div = document.createElement("div");
        div.textContent = text;
        div.className = sender === "user" ? "text-end text-primary mb-2" : "mb-2";
        chatbotMessages.appendChild(div);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
      }

      chatbotToggle.addEventListener("click", () => {
        chatbotWindow.classList.toggle("d-none");
      });
      chatbotClose.addEventListener("click", () => {
        chatbotWindow.classList.add("d-none");
      });

      chatbotSend.addEventListener("click", () => {
        const query = chatbotInput.value.trim();
        if (!query) return;
        appendMessage(query, "user");
        chatbotInput.value = "";

        // Example command handling
        if (query.toLowerCase().startsWith("add")) {
          appendMessage("‚úÖ Item added to cart.");
        } else if (query.toLowerCase().startsWith("remove")) {
          appendMessage("‚ùå Item removed from cart.");
        } else {
          // Example: Fetch products from backend
          fetch(API_BASE + "/product/sel")
            .then((res) => res.json())
            .then((data) => {
              appendMessage(
                "Here are some products: " +
                  data.map((p) => p.name).slice(0, 3).join(", ") +
                  " ..."
              );
            })
            .catch(() => appendMessage("‚ö†Ô∏è Unable to connect to server."));
        }
      });
    </script>
  </body>
</html>
